# USE UMA IMAGEM BASE MÍNIMA DO OPENJDK
FROM maven:3.8.4-openjdk-17 as build

##AJUSTA DATA-HORA
ENV TZ=America/Sao_Paulo

## COPIA SRC PARA /java-estudos/src
COPY src /java-estudos/src

# COPIE APENAS O ARQUIVO POM.XML PARA APROVEITAR O CACHE DO DOCKER
COPY pom.xml /java-estudos

# DEFINA O DIRETÓRIO DE TRABALHO
WORKDIR /java-estudos

# COPIE APENAS O ARQUIVO POM.XML PARA APROVEITAR O CACHE DO DOCKER
RUN mvn clean install

# CRIE UMA IMAGEM MAIS LEVE PARA RODAR A APLICAÇÃO (IMAGEM RUNTIME)
FROM openjdk:17-ea-10-jdk-oracle

# COPIE O ARQUIVO JAR COMPILADO DO ESTÁGIO ANTERIOR PARA O CONTÊINER
COPY --from=build /java-estudos/target/curso-java-0.0.1.jar /java-estudos/curso-java-0.0.1.jar

# DEFINA O DIRETÓRIO DE TRABALHO
WORKDIR /java-estudos

# EXPONHA A PORTA QUE A APLICAÇÃO VAI RODAR
EXPOSE 8080

# EXECUTE A APLICAÇÃO JAVA
CMD [ "java","-jar","curso-javai-0.0.1.jar"]

